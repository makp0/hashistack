---
- name: Install dependencies
  package:
    pkg:
      - zip
      - python3-passlib
      - apt-transport-https
    state: present

- name: Prepare
  include_tasks: _prepare.yml
  tags:
    - prepare
    - loki

- name: Install Loki
  include_tasks: _install.yml
  when: inventory_hostname in groups['hashistack_sre']
  tags:
    - install
    - loki

- name: Configure
  include_tasks: _configure.yml
  when: inventory_hostname in groups['hashistack_sre']
  tags:
    - configure
    - loki

- name: Install Promtail
  include_tasks: _install_promtail.yml
  tags:
    - install
    - promtail

- name: Configure promtail
  include_tasks: _configure_promtail.yml
  tags:
    - configure
    - promtail

